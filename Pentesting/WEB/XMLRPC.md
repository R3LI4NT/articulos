![image](https://github.com/user-attachments/assets/b90d616e-1b28-4531-b7ae-eb1192b11643)<p align="center">
  <a href="https://github.com/DenverCoder1/readme-typing-svg"><img src="https://readme-typing-svg.herokuapp.com?font=Fira+Code&pause=1000&color=D1F700&width=410&lines=Vulnerabilidad+XMLRPC+en+WordPress"></a>
</p>

<h1 align="center"></h1>

<h3 align="center"><ins>¿Qué es el archivo XML-RPC.php?</ins></h3>

El archivo `xml-rpc.php` (Remote Procedure Call, o llamada a procedimiento remoto en XML) es un componente que permite interactuar de forma remota con un sitio web de WordPress mediante el protocolo XML-RPC, permitiendo así realizar diferentes operaciones. 

Entre estas funciones permite:

- **Publicación remota**: Permite a los usuarios publicar contenido en su sitio de WordPress desde aplicaciones externas.

- **Gestión de Contenidos**: Se pueden realizar tareas como editar y eliminar publicaciones, gestionar comentarios y categorías, entre otras.

- **Compatibilidad**: Facilita la integración con otros servicios web y aplicaciones que utilizan el protocolo XML-RPC.


<p align="center">
  <img src="https://github.com/R3LI4NT/articulos/blob/main/Pentesting/WEB/img/XML-RPC.png">
</p>

<h1 align="center"></h1>

</br>

### | Detectar y Explotar XML-RPC

En el siguiente ejemplo voy a utilizar la máquina <a href="https://github.com/R3LI4NT/ctf-retos/blob/main/2-%20Maquinas-Medium/Mr.Robot_1.md">Mr. Robot1</a> para mostrarles el método de detección y explotación de XML-RPC. Como experiencia personal, en entornos reales está vulnerabilidad suele ocurrir frecuentemente.

Por seguridad, siempre que descarguen una máquina de Vulnhub asegúrese de comprobar la salida del hash y compararla con el repositorio oficial. Esto garantizará la integridad del archivo.

```
Get-FileHash -Algorithm MD5 .\mrRobot.ova
```

![1](https://github.com/user-attachments/assets/8e858ad7-c3c3-4912-a2c3-5df728963817)

Una de las formas más fácil de saber si el archivo XML-RPC se encuentra disponible es haciendo uso de WPScan.
```
wpscan --url http://example.com
```

![2](https://github.com/user-attachments/assets/611ff604-2a43-4400-bb1f-415c7f1367b8)

O el método más simple, realizar un fuzzing pero aplicando un filtro con archivos "**.php**".
```
dirb http://example.com /usr/share/wordlists/dirb/common.txt -X '.php'
```

![3](https://github.com/user-attachments/assets/c489150c-fbd4-45cf-a20a-9270cb2aa53e)


Si accedemos al archivo del navegador podemos ver que solamente acepta peticiones a través del método POST.

![4](https://github.com/user-attachments/assets/3722b738-a792-417c-a798-4fbaf1b648b5)

Con el comando curl podemos enviar una petición mediante POST:
```
curl -X POST http://example.com/xmlrpc.php
```

![5](https://github.com/user-attachments/assets/032d29e7-cc90-443f-8594-35ca1275972c)

Soy un usuario que le gusta mucho manejar la terminal antes que cualquier interfaz gráfica, pero cuando se trata de aplicaciones web es indispensable usar Burp para estas pruebas.

![6](https://github.com/user-attachments/assets/58e75750-a8a9-4822-9973-fe1c51468b14)

Para aprovecharse de esta vulnerabilidad se tiene que jugar con las requests, la idea es mandar una petición para enumerar información del wordpress que hay por detrás. Es tan sencillo con hacer una búsqueda en google y acceder a algunos payloads. Por ejemplo: https://github.com/kh4sh3i/xmlrpc-exploit

Al invocar el método `system.listMethods` devuelve una lista de funcionalidades disponibles en el servidor XML-RPC.

![7](https://github.com/user-attachments/assets/e3ab59b9-72f7-49fd-9914-0995687f34c9)

Del lado del Response:

![8](https://github.com/user-attachments/assets/c3449532-2526-48c6-a0aa-1977bd8d89fa)

Una de las primeras funcionalidades que nos permite realizar un ataque de fuerza bruta contra los usuarios de WordPress es el uso del archivo `wp.getUsersBlogs`.

![9](https://github.com/user-attachments/assets/b54e1be9-598f-4cb8-bc89-0dedca901e4e)

El siguiente payload XML permite realizar un ataque de fuerza bruta, primero se le especifica el usuario y por útlimo la contraseña.

```
<?xml version="1.0" encoding="iso-8859-1"?>
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
 <param>
  <value>
   <string>admin</string>
  </value>
 </param>
 <param>
  <value>
   <string>password</string>
  </value>
 </param>
</params>
</methodCall>
```

![10](https://github.com/user-attachments/assets/f20ff35b-1a72-4b72-9899-e356a0162166)

Para enumerar los usuarios podemos hacer uso de WPScan o mandar la petición al Intruder y modificarla desde allí.

Con WPScan:
```
wpscan --url http://example.com --enumerate u
```

![11](https://github.com/user-attachments/assets/51041390-49af-419c-b91d-a26d1b9ce0bf)

No siempre se tiene suerte con la enumeración de usuarios en WPScan, pero en caso de encontrar alguno se podría probar fuerza bruta con los parámetros:
```
wpscan --url http://example.com --passwords /ruta/a/tu/wordlist.txt --usernames USUARIO
```

En el módulo Intruder nos ubicamos en `Positions`, limpiamos haciendo clíc en `Clear§`. Seleccionamos el usuario y le damos en `Add§`, lo mismo con la contraseña.

![12](https://github.com/user-attachments/assets/94cd1038-f966-4bff-9276-31dcdddccd25)

En el "tipo de ataque" seleccionamos modo Cluster bomb, este modo permite ir iterando en ambas posiciones del diccionario para probar todas las combinaciones.

![image](https://github.com/user-attachments/assets/32586b5b-eae2-49b5-ae1d-80b3d2b6db67)

![image](https://github.com/user-attachments/assets/81e9b131-e782-4fc0-8629-5e352ed6cb86)

Ya deberíamos contar con un diccionario propio o descargar uno. Por ejemplo, SecList es un repositorio completo que contiene muchos diccionarios de usuarios, contraseñas, payloads, etc.


