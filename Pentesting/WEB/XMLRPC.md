<p align="center">
  <a href="https://github.com/DenverCoder1/readme-typing-svg"><img src="https://readme-typing-svg.herokuapp.com?font=Fira+Code&pause=1000&color=D1F700&width=410&lines=Vulnerabilidad+XMLRPC+en+WordPress"></a>
</p>

<h1 align="center"></h1>

<h3 align="center"><ins>¿Qué es el archivo XML-RPC.php?</ins></h3>

El archivo `xml-rpc.php` (Remote Procedure Call, o llamada a procedimiento remoto en XML) es un componente que permite interactuar de forma remota con un sitio web de WordPress mediante el protocolo XML-RPC, permitiendo así realizar diferentes operaciones. 

Entre estas funciones permite:

- **Publicación remota**: Permite a los usuarios publicar contenido en su sitio de WordPress desde aplicaciones externas.

- **Gestión de Contenidos**: Se pueden realizar tareas como editar y eliminar publicaciones, gestionar comentarios y categorías, entre otras.

- **Compatibilidad**: Facilita la integración con otros servicios web y aplicaciones que utilizan el protocolo XML-RPC.


<p align="center">
  <img src="https://github.com/R3LI4NT/articulos/blob/main/Pentesting/WEB/img/XML-RPC.png">
</p>

<h1 align="center"></h1>

</br>

### | Detectar y Explotar XML-RPC

En el siguiente ejemplo voy a utilizar la máquina <a href="https://github.com/R3LI4NT/ctf-retos/blob/main/2-%20Maquinas-Medium/Mr.Robot_1.md">Mr. Robot1</a> para mostrarles el método de detección y explotación de XML-RPC. Como experiencia personal, en entornos reales está vulnerabilidad suele ocurrir frecuentemente.

Por seguridad, siempre que descarguen una máquina de Vulnhub asegúrese de comprobar la salida del hash y compararla con el repositorio oficial. Esto garantizará la integridad del archivo.

```
Get-FileHash -Algorithm MD5 .\mrRobot.ova
```

![1](https://github.com/user-attachments/assets/8e858ad7-c3c3-4912-a2c3-5df728963817)

Una de las formas más fácil de saber si el archivo XML-RPC se encuentra disponible es haciendo uso de WPScan.
```
wpscan --url http://example.com
```

![2](https://github.com/user-attachments/assets/611ff604-2a43-4400-bb1f-415c7f1367b8)

O el método más simple, realizar un fuzzing pero aplicando un filtro con archivos "**.php**".
```
dirb http://example.com /usr/share/wordlists/dirb/common.txt -X '.php'
```

![3](https://github.com/user-attachments/assets/c489150c-fbd4-45cf-a20a-9270cb2aa53e)


Si accedemos al archivo del navegador podemos ver que solamente acepta peticiones a través del método POST.

![4](https://github.com/user-attachments/assets/3722b738-a792-417c-a798-4fbaf1b648b5)

Con el comando curl podemos enviar una petición mediante POST:
```
curl -X POST http://example.com/xmlrpc.php
```

![5](https://github.com/user-attachments/assets/032d29e7-cc90-443f-8594-35ca1275972c)

Soy un usuario que le gusta mucho manejar la terminal antes que cualquier interfaz gráfica, pero cuando se trata de aplicaciones web es indispensable usar Burp para estas pruebas.

![6](https://github.com/user-attachments/assets/58e75750-a8a9-4822-9973-fe1c51468b14)

Para aprovecharse de esta vulnerabilidad se tiene que jugar con las requests, la idea es mandar una petición para enumerar información del wordpress que hay por detrás. Es tan sencillo con hacer una búsqueda en google y acceder a algunos payloads. Por ejemplo: https://github.com/kh4sh3i/xmlrpc-exploit

Al invocar el método `system.listMethods` devuelve una lista de funcionalidades disponibles en el servidor XML-RPC.

![7](https://github.com/user-attachments/assets/e3ab59b9-72f7-49fd-9914-0995687f34c9)

Del lado del Response:

![8](https://github.com/user-attachments/assets/c3449532-2526-48c6-a0aa-1977bd8d89fa)

Una de las primeras funcionalidades que nos permite realizar un ataque de fuerza bruta contra los usuarios de WordPress es el uso del archivo `wp.getUsersBlogs`.

![9](https://github.com/user-attachments/assets/b54e1be9-598f-4cb8-bc89-0dedca901e4e)

El siguiente payload XML permite realizar un ataque de fuerza bruta, primero se le especifica el usuario y por útlimo la contraseña.

```
<?xml version="1.0" encoding="iso-8859-1"?>
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
 <param>
  <value>
   <string>admin</string>
  </value>
 </param>
 <param>
  <value>
   <string>password</string>
  </value>
 </param>
</params>
</methodCall>
```

![10](https://github.com/user-attachments/assets/f20ff35b-1a72-4b72-9899-e356a0162166)

Para enumerar los usuarios podemos hacer uso de WPScan o mandar la petición al Intruder y modificarla desde allí.

Con WPScan:
```
wpscan --url http://example.com --enumerate u
```

![11](https://github.com/user-attachments/assets/51041390-49af-419c-b91d-a26d1b9ce0bf)

No siempre se tiene suerte con la enumeración de usuarios en WPScan, pero en caso de encontrar alguno se podría probar fuerza bruta con los parámetros:
```
wpscan --url http://example.com --passwords /ruta/a/tu/wordlist.txt --usernames USUARIO
```

En el módulo Intruder nos ubicamos en `Positions`, limpiamos haciendo clíc en `Clear§`. Seleccionamos el usuario y le damos en `Add§`, lo mismo con la contraseña.

![12](https://github.com/user-attachments/assets/94cd1038-f966-4bff-9276-31dcdddccd25)

En el "tipo de ataque" seleccionamos modo Cluster bomb, este modo permite ir iterando en ambas posiciones del diccionario para probar todas las combinaciones.

![image](https://github.com/user-attachments/assets/32586b5b-eae2-49b5-ae1d-80b3d2b6db67)

Luego de haber hecho lo anterior, nos dirijimos nuevamente a `Intruder` **>** `Payloads`. El Payload 1 indica que el primer diccionario es para descubrir el usuario y en el tipo de payloads lo dejamos en lista simple.

![13](https://github.com/user-attachments/assets/77d139fa-bda8-4bdf-ab96-dcf702c93c9b)

Ya deberíamos contar con un diccionario propio o descargar uno. Por ejemplo, <a href="https://github.com/danielmiessler/SecLists">SecList</a> es un repositorio completo que contiene muchos diccionarios de usuarios, contraseñas, payloads, etc.

En la posición de Payload 2 indicamos el segundo diccionario para descubrir la contraseña.

![14](https://github.com/user-attachments/assets/1a0a21f9-1017-422d-b163-42a613585767)

El siguiente paso será ir a `Intruder` **>** `Payloads` **>** `Settings` y en la sección de "**Grep Match**" damos en Clear. En "Add" agregamos un mensaje que devolverá si la contraseña o usuario es incorrecta.

![image](https://github.com/user-attachments/assets/0e5cecd1-fa12-42b0-a6c6-74abf3133e64)

Y por último, desactivan el proxy `Intercep OFF`, y en Intruder le dan a "**Start Attack**".

![15](https://github.com/user-attachments/assets/66dba397-759c-4d04-a489-d4160dcf5672)

En este caso vemos que el usuario es `Elliot` y la contraseña es `ER28-0652`. Estas credenciales fueron ingresadas intencionalmente solo para desmostrar el procedimiento. Por defecto WordPress tiene un panel de administración ubicado en `/wp-admin` o `/wp-login.php`, pero los desarrolladores suelen desactivarlo y por lo tanto no se podría realizar fuerza bruta con WPScan o Hydra, de ahí la ventaja de probar el XML-RPC (siempre y cuando este activado).

El error más común de WordPress es decirnos que el usuario es correcto, pero la contraseña no. Aquí ya tenemos una pista para empezar la fuerza bruta, dado que el usuario es reconocido.

![16](https://github.com/user-attachments/assets/f0ae2184-6f01-4239-b890-d669cb1e954a)

La vulnerabilidad XML-RPC no solamente sirve para enumerar usuarios o realizar fuerza bruta, hay otros módulos como `pingback.ping` que son útiles para realizar ataques de denegación de servicio distribuido (DDoS) o ataques XSPA. Esto último lo pueden ejecutar a través de las requests.

<h1 align="center"></h1>

</br>

### MITIGAR VULNERABILIDAD XML-RPC

La forma más sencilla de mitigar la vulnerabilidad XML-RPC es editando el archivo de `wp-config.php` con la siguiente línea de código:
```php
add_filter('xmlrpc_enabled', '__return_false');
```

Si tienen permisos para editar el fichero `.htaccess` también puede desactivarlo desde ahí:
```php
# START XML RPC BLOCKING
<Files xmlrpc.php>
Order Deny,Allow
Deny from all
</Files>
# FINISH XML RPC BLOCKING
```

Otra de las medidas que recomiendo para su sitio en WordPress es instalar el plugin "**Stop User Enumeration**" para evitar que usuarios malintencionados enumeren usuarios.

![17](https://github.com/user-attachments/assets/4e387c55-8351-4e49-bb19-8a5a49a06b44)

Finalmente, otros de los tantos plugins que no pueden faltar es "WPS Hide Login", éste último ayuda a ocultar/reemplazar la ruta de acceso `/wp-admin` o `/wp-login.php` por otra.

![18](https://github.com/user-attachments/assets/263ad58c-7f19-4c25-97ae-82467d602965)

![19](https://github.com/user-attachments/assets/f2a6f605-31c5-46bd-8823-03b6f998980c)

</br>

<h1 align="center"></h1>

<h3 align="center"><ins>ADVERTENCIA<ins></h3>

<h4 align="center">Esto es con fines de aprendizaje, no nos hacemos responsables ni el fundador, ni el creador del tema del mal uso de esta herramienta u información.</h4>



#### ~R3LI4NT~

