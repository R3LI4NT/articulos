<p align="center">
  <a href="https://github.com/DenverCoder1/readme-typing-svg"><img src="https://readme-typing-svg.herokuapp.com?font=Fira+Code&size=19&pause=1000&color=D1F700&width=350&lines=Ataque+de+AS-REP+Roasting"></a>
</p>

<h1 align="center"></h1>

<h3 align="center"><ins>Autenticación Kerberos y ataque AS-REP Roasting</ins></h3>

El protocolo Kerberos es usado en la autenticación en entornos Windows/Active Directory (AD). Este permite que los usuarios y servicios se puedan autenticar entre sí de forma segura usando tickets en lugar de enviar las contraseñas.

El flujo típico de autenticación Kerberos funciona de la siguiente manera:
- [AS-REQ] El usuario pide autenticarse al Domain Controller (KDC), enviando su nombre cifrado.

- [AS-REP] El KDC responde con un Ticket Granting Ticket (TGT), cifrado con la clave del usuario.

- El usuario usa ese TGT para pedir acceso a otros servicios (correo, archivos, etc.).

- [TGS-REQ / TGS-REP] Se generan otros tickets para los servicios deseados (como HTTP, CIFS).

El AS-REP Roasting explota cuentas del AD que tienen mala configuración: "Do not require Kerberos preauthentication" (**UF_DONT_REQUIRE_PREAUTH**)". Normalmente, el usuario debe cifrar un timestamp con su contraseña para probar que es él (pre-autenticación), pero si esa opción está desactivada, cualquiera puede pedirle un ASP-REP al DC (Domain Controller) solo sabiendo únicamente el nombre de usuario.

<p align="center">
  <img src="https://github.com/R3LI4NT/articulos/blob/main/Pentesting/O.S/img/AS-REP_Roasting_esq.png">
</p>

<h1 align="center"></h1>

### Enumeración de usuarios | Kerbrute
Para el siguiente ejemplo voy a utilizar la máquina <a href="https://tryhackme.com/room/attacktivedirectory">Attacktive Directory</a> de TryHackMe para mostrar el funcionamiento del ataque. 

<img width="1065" height="256" alt="tryhackme" src="https://github.com/user-attachments/assets/95c6e049-19bf-4d74-a71c-3ea7dae8514c" />


Lo primero que debemos hacer es identificar el nombre del dominio, lo cual podemos lograr utilizando Nmap, como se muestra a continuación.
```
nmap -p- --open -sS -vvv -n -Pn <IP>
```

<img width="812" height="236" alt="1" src="https://github.com/user-attachments/assets/a9ef42b3-fd0d-468f-b19c-1f43655763f8" />

```
nmap -p 389,636,3268,3269,88,445 --script ldap-search,ldap-rootdse <IP>
```
<img width="1027" height="451" alt="2" src="https://github.com/user-attachments/assets/94968195-854e-4d2d-8e50-69a009a7e518" />

Luego de identificar el nombre de dominio (`spookysec.local`), utilizando la herramienta de <a href="https://github.com/ropnop/kerbrute">Kerbrute</a> se procederá a realizar una enumeración de usuarios utilizando una wordlist propia o pública como <a href="https://github.com/danielmiessler/SecLists">SecLists</a>.
