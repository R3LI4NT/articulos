<p align="center">
  <a href="https://github.com/DenverCoder1/readme-typing-svg"><img src="https://readme-typing-svg.herokuapp.com?font=Fira+Code&pause=1000&color=D1F700&width=435&lines=Ataque+de+Local+File+Inclusion+(LFI)"></a>
</p>

<h1 align="center"></h1>

<h3 align="center"><ins>Vulnerabilidad LOCAL FILE INCLUSION</ins></h3>

La vulnerabilidad de inclusión de archivos (LFI) es un ataque en la que los atacantes engañan a una aplicación web para que ejecute o exponga achivos privados en un servidor web. Estos archivos pueden exponer información confidencial y, en casos graves, pueden generar secuencias de comandos entre sitios (<a href="https://github.com/R3LI4NT/articulos/blob/main/Pentesting/WEB/ataqueXSS.md">Cross-Site Scripting</a>) y ejecucción remota de código. LFI figura en el top de las principales vulnerabilidades de aplicaciones web de OWASP. Dependiendo de la gravedad, también puede conducir a:

- Denegación de Servicio (DoS).

- Ejecucción de código del lado del cliente, como JavaScript, que da lugar a ataques XSS.

- Ejecución de código en el servidor web.

- Exposición de información confidencial.

<p align="center">
  <img src="https://github.com/R3LI4NT/articulos/blob/main/Pentesting/WEB/img/esquema_LFI.png">
</p>

</br>

#### ¿Cómo funciona?

Esta vulnerabilidad existe cuando una aplicación web incluye un archivo sin desinfectar correctamente la entrada, lo que permite que un atacante manipule la entra de la URL e inyecte caracteres transversales en la ruta (como **../**) en busca de archivos existentes en el servidor web. Ocasionalmente, ocurre cuando una página recibe, como entrada, la ruta del archivo que debe incluirse y esta entrada no se desinfecta adecuadamente. La mayoría de ejemplos apuntan a scripts PHP vulnerables, aunque también se da en caso de tecnologías como ASP, JSP, entre otras.

La siguiente URL es un ejemplo de cómo un LFI permite a los atacantes extraer información confidencial de un servidor por medio del nombre de un archivo:

```
https://website.com/?module=products.php
```

Un atacante puede modificar la URL para que sea vea así:

```
https://website.com/?module=../../../../etc/passwd
```
Lo que hará aquí el servidor es mostrar el contenido del fichero `/etc/passwd`. El contenido de este fichero determina quien puede acceder al sistema de manera legitima y que se puede hacer dentro del sistema. Se debe ser sumamanete cuidadoso con él, evitar errores y fallos de seguridad que puedan comprometer el sistema a base de accesos no autorizados. El fichero registra todas las cuentas de usuarios, así como las claves y privilegios de las mismas. Si se cumplen las condiciones mencionadas anteriormente, un atacante vería algo como lo siguiente:
```
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
alex:x:500:500:alex:/home/alex:/bin/bash
margo:x:501:501::/home/margo:/bin/bash
```

<p align="center">
  <img src="https://github.com/R3LI4NT/articulos/blob/main/Pentesting/WEB/img/fichero_valores.png">
</p>

- **1)** `Usuario`: Se utiliza cuando el usuario inicia sesión. Debe tener entre 1 y 32 caracteres de longitud.

- **2)** `Contraseña`: El carácter x nos indica que la contraseña cifrada se almacena en el archivo /etc/shadow.

- **3)** `ID de usuario (UID)`: Cada usuario debe tener asignado un ID de usuario (UID). El UID 0 (cero) está reservado para root y los UID 1-99 están reservados para otras cuentas predefinidas. El sistema reserva más UID 100-999 para cuentas/grupos administrativos y del sistema.

- **4)** `ID de grupo (GID)`: Es el ID del grupo principal al que pertenece el usuario (almacenado en el archivo /etc/group).

- **5)** `Información de ID de usuario (GECOS)`: Es el campo de comentarios. Le permite agregar información adicional sobre los usuarios, como el nombre completo del usuario, el número de teléfono, etc.

- **6)** `Directorio de inicio`: La ruta absoluta al directorio en el que estará el usuario cuando inicie sesión. Si este directorio no existe, el directorio de usuarios se convierte en **/**.

- **7)** `Commando/Shell`: Esta es la ruta absoluta del shell (/bin/bash) predeterminado para el inicio de sesión del usuario del sistema GNU/Linux. 


El shell establecido en **/sbin/nologin** indica que deniega el acceso al usuario de iniciar sesión al sistema GNU/Linux.

![1](https://user-images.githubusercontent.com/75953873/192151584-745d2732-fd60-4a63-a68b-ba09a25a83d2.png)

</br>

#### Inyección de Bytes Nulos

La inyección de bytes nulos es una técnica de explotación activa que se utiliza para evadir los filtros de verificación de la infraestructura web al añadir caracteres de bytes nulos codificados en URL (%00 o 0x00 en hexadecimal) a los datos proporcionados por el usuario. Esta técnica se puede utilizar para realizar otros ataques, como la exploración de directorios, el cruce de rutas, la inyección de SQL, la ejecución de código arbitrario, otros. En el caso de LFI, se utiliza como carácter reservado para marcar el final de una cadena. Una vez utilizado, se ignorará cualquier carácter después de este byte especial. Por lo general, la forma de inyectar este carácter sería con la cadena codificada de URL **%00** agregándola a la ruta solicitada, por ejemplo:
```
https://website.com/index.php?file=../../../../etc/passwd%00
```
El ejemplo anterior lo que hace es ignorar la extensión `php` que se agrega al nombre de archivo de entrada, devolviendo una lista de usuarios.

#### Codificación

La manipulación de variables que hacen referencia a archivos de secuencias de `../` y sus variaciones, permite eludir el filtrado de entrada mal implementado. Algunos ejemplos son:

|  | URL | URL Doble | Unicódigo UTF-8 | Unicode de 16 bits |
| ------------- | ------------- | ------------- | ------------- | ------------- |
| . | %2e | %252e | %c0%2e %e0%40%ae %c0%ae | %u002e |
| / | %2f | %252f | %c0%2f %e0%80%af %c0%af | %u2215 |
| \ | %2c |%252c | %c0%5c %c0%80%5c | %u2216 |
| ../ | %2e%2e%2f | %252e%252e%252f | %c0%ae%c0%ae%c0%af | %uff0e%uff0e%u2215 |
| ..\ | %2e%2e%2c | %252e%252e%252c | %c0%ae%c0%ae%c0%af | %uff0e%uff0e%u2216 |

URL Doble:
```
https://website.com/index.php?file=%252e%252e%252fetc%252fpasswd
```

Unicódigo UTF-8:
```
https://website.com/index.php?file=%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/etc/passwd
```

Bypass filtro:
```
https://website.com/index.php?file=..///////..////..//////etc/passwd
```
