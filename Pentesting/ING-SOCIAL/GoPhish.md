<p align="center">
  <a href="https://github.com/DenverCoder1/readme-typing-svg"><img src="https://readme-typing-svg.herokuapp.com?color=D1F700&width=500&lines=Configurar+GoPhish,+Mailgun,+Cloudflare"></a>
</p>

<h1 align="center"></h1>

<h3 align="center">Simulacros de Phishing - Entornos Reales </h3>

Cuando hablamos de phishing, suele venirnos a la mente la palabra “ilegal” o “estafa”. Y no es incorrecto: se trata de un método fraudulento cuyo propósito es engañar al usuario para que haga clic en un enlace malicioso, descargue un archivo peligroso o entregue información confidencial.

Sin embargo, en los simulacros de phishing, aunque se reproduce un escenario similar, el objetivo es completamente diferente. Estas pruebas controladas están diseñadas para evaluar la capacidad de los empleados para identificar y manejar correos electrónicos de phishing. Las simulaciones replican ataques reales, con mensajes convincentes y contextos cotidianos, para detectar posibles vulnerabilidades humanas dentro de la organización.

El propósito final es reforzar la conciencia en ciberseguridad, medir el riesgo interno y capacitar al personal, ofreciendo retroalimentación educativa basada en sus respuestas ante los intentos simulados.

### Tipos de Campañas
Normalmente, al diseñar campañas de phishing para evaluarlas con el cliente, se crean al menos dos temáticas: una `genérica` y otra `dirigida`. La temática genérica está orientada a simular ataques masivos y ampliamente distribuidos, mientras que la temática dirigida se enfoca en ataques más personalizados, adaptados al contexto o perfil del cliente, imitando técnicas de spear phishing.

Por ejemplo, una campaña genérica busca captar la atención del mayor número posible de usuarios, sin importar su rol dentro de la empresa. Este tipo de simulaciones utiliza temáticas ampliamente atractivas, como ofertas de descuento, regalos, invitaciones a webinars, entre otras.

En cambio, una campaña dirigida se enfoca en un grupo específico dentro de la organización, como jefes, gerentes o empleados de un área determinada. Las temáticas en estos casos suelen ser más personalizadas y creíbles, incluyendo mensajes sobre actualizaciones de contraseña, instalación de parches de seguridad o solicitudes internas de acción.

<p align="center">
   <img src="https://github.com/R3LI4NT/articulos/blob/main/Pentesting/ING-SOCIAL/img/phishing_campa%C3%B1as.png">
</p>

<h1 align="center"></h1>

### Compra de Dominio 
Lo primero y más importante al preparar una campaña de phishing es la suplantación del dominio oficial del cliente. Para que el ataque simulado sea convincente, es fundamental que el dominio utilizado en los correos se asemeje al original.

Por ejemplo, si la página legítima es `secure-offs.com`, podríamos registrar un dominio similar y disponible como `secure-ofs.com` o `secur-offs.com`. La idea es agregar, eliminar o modificar ligeramente una letra de forma sutil, de manera que pase desapercibido para el usuario y aumente la probabilidad de que caiga en el phishing.

Una vez elegido el dominio, es necesario verificar su disponibilidad en el proveedor de dominios seleccionado. Algunos proveedores comunes para este fin son Hostinger, SiteGround, GoDaddy, entre otros. Es importante asegurarse de que el dominio esté libre y pueda registrarse de inmediato, ya que esto será clave para montar la infraestructura de la campaña de phishing simulada.

<img width="1333" height="513" alt="1" src="https://github.com/user-attachments/assets/1823c92b-6917-4ea9-80c7-2136554f7782" />

<h1 align="center"></h1>

### Configuración de Cloudflare + Mailgun
El siguiente paso, una vez adquirido el dominio, es registrarlo en Cloudflare. Esto nos permitirá obtener un certificado SSL gratuito, lo que hace que el sitio suplantado se cargue bajo el protocolo HTTPS. Esta capa de seguridad es fundamental para que la página luzca confiable ante el usuario y no genere sospechas por falta de cifrado o advertencias del navegador.

Nos creamos una cuenta de Cloudflare y registramos el dominio que compramos.

<img width="1332" height="487" alt="cloudflare-1" src="https://github.com/user-attachments/assets/0ca56865-87ae-409f-a502-2d6a2d019b43" />


Luego registramos los servidores de nombre que nos devuelve Cloudflare a nuestro proveedor de Hosting.

<img width="1062" height="342" alt="cloudflare-2" src="https://github.com/user-attachments/assets/455fb495-10e6-403d-86b8-11e3bd05a365" />

Nuevamente nos dirigimos a Cloudflare y registramos los DNS correspondientes. En dirección IPv4 especifican la de Cloudflare y desactivan el estado de proxy, la misma configuración para el subdominio "www".

<img width="1433" height="515" alt="cloudflare-3" src="https://github.com/user-attachments/assets/6c319856-60ea-486f-82eb-6da78910ad02" />

<a href="https://www.mailgun.com/">Mailgun</a> es un servicio de SMTP que funciona como intermediario (API) para enviar múltiples correos electrónicos a la vez, esto nos será útil para enviar la campaña a varios usuarios. Nos creamos una cuenta y damos en `Sending` **->** `Domains` **->** `Add new domain`.

<img width="1298" height="931" alt="mailgun-1" src="https://github.com/user-attachments/assets/9b45f3f2-738a-4134-8b35-86d35db304eb" />

Se nos creará varios registros sin verificar en el Mailgun, debemos de trasladarlos al Cloudflare para que puedan ser verificados.

<img width="1550" height="918" alt="mailgun-2" src="https://github.com/user-attachments/assets/6f61e7e0-72f2-4018-93ca-df44a0464dfa" />

Es importante siempre respetar el Tipo, Nombre y Valor de cada registro que nos devuelve Mailgun. En algun tipos como `MX` necesitan especificarle la propiedad que suele ser `10`.

<img width="1420" height="292" alt="mailgun-3" src="https://github.com/user-attachments/assets/55418353-fa00-4ca5-b7a5-d34d722ce3eb" />

Por último, le damos en verificar DNS en Mailgun y esperamos que se aplique la configuración. Está última parte puede demorar algunos minutos.

<h1 align="center"></h1>

### Configuración de GoPhish + Mailgun
<a href="https://github.com/gophish/gophish">GoPhish es una herramienta de código abierto diseñada para realizar campañas de phishing, en el siguiente <a href="https://www.youtube.com/watch?v=xjQEsS2s6yQ">enlace</a> encontrarán un video de instalación.

Luego de registrar el dominio y configurar los parámetros de DNS que apuntan al servidor. Se crea el certificado HTTPS usando la herramienta de <a href="https://certbot.eff.org/">Cerbot</a>
```
cerbot certonly -d <dominio.com>
```

Seleccionar la opción `2`.

<img width="1083" height="427" alt="certbot-1" src="https://github.com/user-attachments/assets/dbedf329-e67f-4f86-aaa0-b5b62bffb3be" />

Después procedemos a editar el archivo `config.json` de `/opt/gophish`. Debemos ingresar el nombre de dominio que registramos anteriormente.

<img width="1077" height="550" alt="gophish-1" src="https://github.com/user-attachments/assets/fb3c2807-dbb1-4040-a0d6-9d0f228733a5" />

Para configurar una campaña se hace desde abajo hacia arriba. Primero empezamos con el apartado de `Sending Profiles`: aquí se va a especificar el servidor SMTP que creamos en Mailgun.

<img width="1525" height="957" alt="gophish-2" src="https://github.com/user-attachments/assets/8bb2e433-8f9e-4c45-a694-aa823c4ff061" />

Para crear un usuario SMTP se deben ir a Mailgun nuevamente y en en `Domain Setting` deben darle a `SMTP credentials` **->** `Add new SMTP user` y en `Login*` deben ingresar un nombre de usuario de emisor. Por ejemplo `seguridad`, los correos que envién al receptor serán de `seguridad@<dominio-que-compraron.com>`.

<img width="1488" height="636" alt="gophish-3" src="https://github.com/user-attachments/assets/4986631a-f200-4f89-bf02-7aa5ba4523f1" />

Se les creará una contraseña para ese usuario SMTP.

<img width="745" height="237" alt="gophish-4" src="https://github.com/user-attachments/assets/aec9b8f9-5671-4c8f-b329-8d49e7779d68" />

Vuelven a GoPhish y configuran los datos del SMTP.

<img width="865" height="781" alt="gophish-5" src="https://github.com/user-attachments/assets/7bf2333c-0e7b-4716-8040-8838fbbcaaf4" />

En caso de que tengan errores al enviar los correos más adelante, pueden resetear la contraseña del SMTP y volverla a cargar en el GoPhish.

<img width="1201" height="243" alt="gophish-6" src="https://github.com/user-attachments/assets/7872d775-14d7-4f11-9f13-87c0fb231023" />

En el apartado de `Landing Pages`: se debe pegar el código fuente de la campaña (página, portal, etc) y seleccionar las dos casillas para capturar la información (Usuarios, Contraseñas, etc), así como indicarle el sitio legítimo a donde se redirigirá el usuario final una vez que ingrese los datos.

Deben importar el código HTML.

<img width="871" height="870" alt="gophish-7" src="https://github.com/user-attachments/assets/8c49d057-d72f-4b88-ba27-9cf5c3e38fd6" />

`IMPORTANTE:` Para que GoPhish pueda capturar los datos, se debe incluir jQuery en el código y pasarle el type e ID. Cuando el usuario escriba los datos y presione en el botón para enviarlos, se recomienda que éste se cree con un input de `type=submit`.

<img width="796" height="472" alt="gophish-8" src="https://github.com/user-attachments/assets/3304cb48-b375-4cba-b119-988fb702a225" />

En el apartado de `Email Templates`: se adjunta el diseño HTML qye vanis a usar enviar los emails.

<img width="882" height="900" alt="gophish-9" src="https://github.com/user-attachments/assets/d48c9974-c090-4440-814c-92355142ba19" />

`IMPORTANTE`: Si tenemos un diseño de email que incluye un botón para redirigir al usuario final al sitio web de phishing, GoPhish utiliza etiquetas especiales como `{{.URL}}`.

<img width="746" height="130" alt="gophish-10" src="https://github.com/user-attachments/assets/7228b556-5dbe-4079-b373-7437a91ee9de" />

En el apartado de `Users & Groups`: seleccionar los destinarios de la campaña. Cuando se realizan pruebas internas con el cliente se recomienda siempre utilizar correos temporales como <a href="https://temp-mail.org/es/">temp-mail</a> para evitar que Gmail aprenda por su cuenta y tome los correos como spam.

<img width="860" height="727" alt="gophish-11" src="https://github.com/user-attachments/assets/de0d45cb-6ed5-4f61-af12-7fa99c135fba" />

Por último, quedaría ejecutar la campaña en el apartado de `Campaigns`: rellenar todos los campos de los pasos anteriores, especificarle el dominio falso que compraron y registraron.

<img width="1372" height="881" alt="gophish-12" src="https://github.com/user-attachments/assets/183111cd-f443-40bf-9103-ca334b7cd09a" />

Correo del emisor:

<img width="1410" height="683" alt="gophish-13" src="https://github.com/user-attachments/assets/daa0c9a6-ec89-419a-980b-4063ef576769" />

En caso de que el usuario final lea el correo, entre al sitio o inclusive ingrese credenciales, GoPhish registrará toda la actividad en su panel de control.

<img width="1546" height="747" alt="gophish-14" src="https://github.com/user-attachments/assets/63d9fd93-c891-43ed-b7cc-1f68ce707b37" />

<img width="1290" height="816" alt="gophish-15" src="https://github.com/user-attachments/assets/5848c56c-7ff8-44b5-b4a0-ebe6cc9f7193" />

<h1 align="center"></h1>

</br>

### CONCLUSIONES FINALES
Los simulacros de phishing son un servicio diseñado para reforzar la conciencia y preparación ante este tipo de ataques, que actualmente representan uno de los vectores más comunes para la propagación de malware. A través de estas simulaciones controladas, se busca educar a los usuarios y reducir el riesgo humano dentro de la organización.

Es importante siempre revisar el nombre del emisor del correo, nombre del dominio y reportar en todo caso de que se trate de un phishing, así como tampoco descargar y ejecutar nada en el sistema. Es recomendable siempre mantener activado la autenticación doble factor (MFA) en caso de robo de credenciales.

<img width="273" height="361" alt="11" src="https://github.com/user-attachments/assets/d3a34618-9442-4e2b-88fb-6905be714f02" />

</br>

<h1 align="center"></h1>
