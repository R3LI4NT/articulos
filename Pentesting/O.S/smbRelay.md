<p align="center">
  <a href="https://github.com/DenverCoder1/readme-typing-svg"><img src="https://readme-typing-svg.herokuapp.com?color=003CF7&width=480&lines=Envenenamiento+LMMNR%2FNBT-NS+%5BSMB-Relay%5D"></a>
</p>

<h1 align="center"></h1>

El ataque SMB Relay es un ataque muy utilizado para ganar acceso a equipos privilegiados y no privilegiados. En las redes existen sistemas automatizados que se conectan a otros equipos para realizar diversas tareas tipo: backups, actualizar antivirus y controladores, revisar inventario del software instalado y demás. Dichos sistemas para conectarse a otros equipos necesitan proveer a los mismos las credenciales válidas para llevar a cabo la autenticación. Y aquí es donde viene lo jugoso, el atacante lo que hace es interceptar las conexiones entre esos sistemas (con su dirección IP interna/local) para capturar el usuario y contraseña, en el caso de la contraseña, viajará hasheada.

La autenticación se realiza por medio del protocolo NTLM, mismo que contiene un hash para almacenar las contraseñas de sistemas Windows.

![1](https://user-images.githubusercontent.com/75953873/180976862-a5c4eaf9-7d77-4768-8f39-f9865e771f35.png)

Ataque intermediario (**MITM**) - Envenenamiento

`User A`: Envía un mensaje de autenticación al `User B`

`Atacante`: Intercepta primero el mensaje y lo pasa al `User B`

`User B`: Recibe el mensaje y envía el desafío encriptado en un hash hacia el `User A`

`User A`: Resuelve el desafío y lo envía hacia el `User B`

`Atacante`: Intercepta el desafío (**hash**)

`User B`: Decide si otorgar acceso o denegarlo.

El atacante graba el Hash-SMB para luego crackear el login por fuerza bruta.
<h1 align="center"></h1>

### RESPONDER

Una de las herramientas que suelo utilizar personalmente es Responder, un script hecho en python para envenenar (escuchar) las autenticaciones que viajan en la red, tales como: HTTP/SMB/MSSQL/FTP/LDAP/NTLMv1/NTLMv2/LMv2. Para descargar el repositorio ejecutan el siguiente comando:
```
git clone https://github.com/SpiderLabs/Responder && cd Responder
```

Para poner en marcha las escuchas:
```python
python2 Responder.py -I <INTERFAZ> -w -r -f -v 
```

**-I**: Interfaz de red.

**-w**: Inicie el servidor proxy no autorizado WPAD. El valor predeterminado es falso.

**-r**: Habilitar las respuestas para las consultas de sufijo wredir de netbios. Responder a wredir probablemente rompa cosas en la red. Valor predeterminado: falso.

**-f**: Esta opción le permite tomar la huella digital de un host que emitió una consulta NBT-NS o LLMNR.

**-v**: Modo verbose (más detalles).

![2](https://user-images.githubusercontent.com/75953873/180978707-5b9ef34e-746e-4f1e-9fd7-d4ef51f6c649.png)

En mi caso, escogí Windows 7 a explotar como entorno controlado en una VM. Lo probé en mi máquina física con Windows 10 y funciono sin problemas. En Windows me dirigí a Explorador de archivos **->** Acceso rápido y en la barra de búsqueda escribí `//printserver`, es un servidor que conecta una impresora de red al sistema que la esté autenticando.

![3](https://user-images.githubusercontent.com/75953873/180978928-092e50a1-b266-4613-9035-74d8d0f2c1ec.png)
